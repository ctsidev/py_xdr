-- PAT
DROP TABLE xdr_<<PROJECT_ID>>_pat PURGE;
CREATE TABLE xdr_<<PROJECT_ID>>_pat AS
SELECT DISTINCT pat.pat_id
    ,pat.pat_mrn_id
    ,pat.pat_mrn_id                                                 MRN
    ,i2b2.f_get_deid_new(1, pat.pat_id, <<PROJECT_ID>>)             ip_patient_id
    ,pat.birth_date                                                 DOB
    ,pat.ethnic_group                                               ETHNICITY
    ,pat.mapped_race_name                                           RACE
    ,pat.sex                                                        SEX
    ,pat.language                                                   LANGUAGE
    ,pat.marital_status                                             MARITAL_STATUS
    ,pat.religion                                                   RELIGION
    ,pat.cur_pcp_prov_id
    ,to_number(i2b2.f_death(pat.pat_id, 3, 1))                      AGE
    ,i2b2.f_death(pat.pat_id, 2, 1)                                 VITAL_STATUS
    ,i2b2.f_death(pat.pat_id, 1, 1)                                 death_date
    ,geo.ADI_NATRANK
    ,geo.ADI_STATERNK
    ,geo.education_cd
    ,geo.income_cd
    ,geo.Svi_Socio_Econ
    ,geo.SVI_HCOMP_LANG
    ,geo.Svi_Mino_Lang
    ,geo.SVI_HTYP_TRANS
    ,geo.Svi_Total
FROM i2b2.lz_clarity_patient        pat
JOIN xdr_<<PROJECT_ID>>_coh         coh ON pat.pat_id = coh.pat_id
LEFT JOIN JSANZ.BIP_PAT_GEOCODE    geo ON pat.pat_id = geo.pat_id
;